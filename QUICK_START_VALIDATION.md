# å¿«é€Ÿå¼€å§‹ï¼šè®¾ç½®éªŒè¯é›†

## ğŸ¯ ç›®æ ‡

ä¸ºè®­ç»ƒæ·»åŠ éªŒè¯é›†ï¼Œè®©ä½ èƒ½çœ‹åˆ° PSNR/SSIM ç­‰å…³é”®æŒ‡æ ‡ï¼Œé¿å…ç›²ç›®è®­ç»ƒã€‚

## âš¡ ä¸€é”®æ‰§è¡Œï¼ˆæ¨èï¼‰

```bash
cd /root/lada
./create_validation_set.sh
```

è¿™ä¼šä»ä½ çš„2019ä¸ªè®­ç»ƒæ ·æœ¬ä¸­åˆ’åˆ†å‡ºçº¦200ä¸ªï¼ˆ10%ï¼‰ä½œä¸ºéªŒè¯é›†ã€‚

## ğŸ“Š å½“å‰çŠ¶æ€

- âœ… è„šæœ¬å·²åˆ›å»º
- âœ… é…ç½®æ–‡ä»¶å·²æ›´æ–°
- â¸ï¸ ç­‰å¾…ä½ æ‰§è¡Œåˆ’åˆ†

## ğŸ”„ å®Œæ•´å·¥ä½œæµ

### 1. åˆ’åˆ†éªŒè¯é›†

```bash
cd /root/lada
./create_validation_set.sh
```

**é¢„æœŸè¾“å‡º**ï¼š
```
==========================================
  éªŒè¯é›†è‡ªåŠ¨åˆ’åˆ†å·¥å…·
==========================================

ğŸ“Š å½“å‰è®­ç»ƒé›†æ ·æœ¬æ•°: 2019

ğŸ“‹ åˆ’åˆ†é…ç½®:
   - éªŒè¯é›†æ¯”ä¾‹: 0.1 (10% = 201 ä¸ªæ ·æœ¬)
   - æºè®­ç»ƒé›†: /root/autodl-tmp/train_with_mosaic
   - ç›®æ ‡éªŒè¯é›†: /root/autodl-tmp/train_with_mosaic_val

æ˜¯å¦ç»§ç»­ï¼Ÿ[y/N]
```

è¾“å…¥ `y` åä¼šè‡ªåŠ¨å®Œæˆåˆ’åˆ†ã€‚

### 2. åœæ­¢å½“å‰è®­ç»ƒï¼ˆå¦‚æœæ­£åœ¨è¿è¡Œï¼‰

```bash
pkill -f train-mosaic-restoration-basicvsrpp
```

### 3. é‡æ–°å¯åŠ¨è®­ç»ƒ

```bash
cd /root/lada
./run_multi_gpu_training.sh
```

### 4. è§‚å¯ŸéªŒè¯æŒ‡æ ‡

è®­ç»ƒæ—¶æ¯3000ä¸ªiterationä¼šè¾“å‡ºï¼š

```
10/07 15:05:00 - mmengine - INFO - Validation Results:
10/07 15:05:00 - mmengine - INFO -   PSNR: 28.5  â† è¶Šé«˜è¶Šå¥½ (>30ä¸ºä½³)
10/07 15:05:00 - mmengine - INFO -   SSIM: 0.87  â† è¶Šé«˜è¶Šå¥½ (>0.9ä¸ºä½³)
```

## ğŸ“ˆ æŒ‡æ ‡è¯´æ˜

| æŒ‡æ ‡ | å«ä¹‰ | å¥½çš„èŒƒå›´ | è¯´æ˜ |
|------|------|---------|------|
| **PSNR** | å³°å€¼ä¿¡å™ªæ¯” | > 30 dB | è¶Šé«˜è¶Šå¥½ï¼Œè¡¨ç¤ºé‡å»ºè´¨é‡ |
| **SSIM** | ç»“æ„ç›¸ä¼¼æ€§ | > 0.9 | è¶Šé«˜è¶Šå¥½ï¼Œè¡¨ç¤ºç»“æ„ä¿æŒ |
| **Training Loss** | è®­ç»ƒæŸå¤± | æŒç»­ä¸‹é™ | Charbonnier Loss |

## ğŸ¬ éªŒè¯æ—¶é—´çº¿

åŸºäºä½ å½“å‰çš„é…ç½®ï¼ˆ30k iterationsï¼‰ï¼š

```
Iter 3000  â†’ é¦–æ¬¡éªŒè¯ (10%)
Iter 6000  â†’ ç¬¬2æ¬¡éªŒè¯ (20%)
Iter 9000  â†’ ç¬¬3æ¬¡éªŒè¯ (30%)
Iter 12000 â†’ ç¬¬4æ¬¡éªŒè¯ (40%)
Iter 15000 â†’ ç¬¬5æ¬¡éªŒè¯ (50%)
Iter 18000 â†’ ç¬¬6æ¬¡éªŒè¯ (60%)
Iter 21000 â†’ ç¬¬7æ¬¡éªŒè¯ (70%)
Iter 24000 â†’ ç¬¬8æ¬¡éªŒè¯ (80%)
Iter 27000 â†’ ç¬¬9æ¬¡éªŒè¯ (90%)
Iter 30000 â†’ æœ€ç»ˆéªŒè¯ (100%)
```

## ğŸ› ï¸ é«˜çº§é€‰é¡¹

### ä½¿ç”¨å›ºå®šæ•°é‡

å¦‚æœä½ æƒ³æŒ‡å®šå›ºå®šæ•°é‡ï¼ˆå¦‚300ä¸ªï¼‰ï¼š

```bash
python scripts/dataset_creation/split-train-val-dataset.py \
    --src-root /root/autodl-tmp/train_with_mosaic \
    --val-size 300
```

### é¢„è§ˆæ¨¡å¼ï¼ˆä¸å®é™…æ‰§è¡Œï¼‰

æƒ³å…ˆçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆï¼š

```bash
python scripts/dataset_creation/split-train-val-dataset.py \
    --src-root /root/autodl-tmp/train_with_mosaic \
    --val-size 200 \
    --dry-run
```

### ä¿ç•™è®­ç»ƒé›†æ ·æœ¬

å¦‚æœä½ æƒ³åœ¨éªŒè¯é›†å’Œè®­ç»ƒé›†ä¸­éƒ½ä¿ç•™è¿™äº›æ ·æœ¬ï¼š

```bash
python scripts/dataset_creation/split-train-val-dataset.py \
    --src-root /root/autodl-tmp/train_with_mosaic \
    --val-size 200 \
    --no-remove
```

âš ï¸ **æ³¨æ„**ï¼šè¿™ä¼šå¯¼è‡´éªŒè¯æŒ‡æ ‡åé«˜ï¼Œå› ä¸ºæ¨¡å‹åœ¨è¿™äº›æ ·æœ¬ä¸Šè®­ç»ƒè¿‡ã€‚

## ğŸ“ ç»“æœæ£€æŸ¥

åˆ’åˆ†å®Œæˆåæ£€æŸ¥ï¼š

```bash
# æ£€æŸ¥è®­ç»ƒé›†å‰©ä½™æ ·æœ¬æ•°
find /root/autodl-tmp/train_with_mosaic/crop_unscaled_meta -name "*.json" | wc -l
# åº”è¯¥æ˜¾ç¤º: ~1819

# æ£€æŸ¥éªŒè¯é›†æ ·æœ¬æ•°
find /root/autodl-tmp/train_with_mosaic_val/crop_unscaled_meta -name "*.json" | wc -l
# åº”è¯¥æ˜¾ç¤º: ~200
```

## ğŸš¨ å¸¸è§é—®é¢˜

### Q: å·²ç»å¼€å§‹è®­ç»ƒäº†æ€ä¹ˆåŠï¼Ÿ

A: æ²¡é—®é¢˜ï¼å…ˆåœæ­¢è®­ç»ƒï¼Œåˆ’åˆ†éªŒè¯é›†ï¼Œç„¶åé‡å¯ã€‚checkpointä¼šä¿ç•™ï¼Œå¯ä»¥ç”¨ `--resume` ç»§ç»­ã€‚

### Q: éªŒè¯é›†ä¼šå½±å“è®­ç»ƒé€Ÿåº¦å—ï¼Ÿ

A: æ¯3000 iteréªŒè¯ä¸€æ¬¡ï¼Œæ¯æ¬¡çº¦éœ€å‡ åˆ†é’Ÿã€‚æ€»ä½“å½±å“<5%ã€‚

### Q: èƒ½æ”¹å˜éªŒè¯é¢‘ç‡å—ï¼Ÿ

A: å¯ä»¥ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ `val_interval`ï¼š
```python
train_cfg = dict(
    type='IterBasedTrainLoop', 
    max_iters=30_000,
    val_interval=5_000)  # æ”¹æˆ5000å°±æ˜¯æ¯5kéªŒè¯ä¸€æ¬¡
```

### Q: éªŒè¯æŒ‡æ ‡å¤šå°‘ç®—å¥½ï¼Ÿ

A: å‚è€ƒå€¼ï¼ˆé©¬èµ›å…‹ä¿®å¤ä»»åŠ¡ï¼‰ï¼š
- PSNR > 28: åŸºæœ¬å¯ç”¨
- PSNR > 30: è¾ƒå¥½
- PSNR > 32: ä¼˜ç§€
- SSIM > 0.85: åŸºæœ¬å¯ç”¨
- SSIM > 0.90: è¾ƒå¥½

## ğŸ“š æ›´å¤šä¿¡æ¯

- è¯¦ç»†æŒ‡å—ï¼š[VALIDATION_SET_GUIDE.md](VALIDATION_SET_GUIDE.md)
- å‚æ•°å¯¹æ¯”ï¼š[TRAINING_PARAMS_COMPARISON.md](TRAINING_PARAMS_COMPARISON.md)
- å®Œæ•´æ—¥å¿—ï¼š[CHANGELOG.md](CHANGELOG.md)

## âœ… æ£€æŸ¥æ¸…å•

- [ ] æ‰§è¡Œ `./create_validation_set.sh` åˆ’åˆ†éªŒè¯é›†
- [ ] éªŒè¯è®­ç»ƒé›†å‡å°‘åˆ°~1819ä¸ªæ ·æœ¬
- [ ] éªŒè¯é›†åˆ›å»ºæˆåŠŸï¼ŒåŒ…å«~200ä¸ªæ ·æœ¬
- [ ] é…ç½®æ–‡ä»¶å·²æ›´æ–°ï¼ˆval_rootè·¯å¾„ï¼‰
- [ ] åœæ­¢å½“å‰è®­ç»ƒï¼ˆå¦‚æœæ­£åœ¨è¿è¡Œï¼‰
- [ ] é‡å¯è®­ç»ƒå¹¶è§‚å¯ŸéªŒè¯æŒ‡æ ‡

---

**åˆ›å»ºæ—¶é—´**: 2025-10-07  
**è„šæœ¬ä½ç½®**: `create_validation_set.sh` å’Œ `scripts/dataset_creation/split-train-val-dataset.py`  
**é…ç½®æ–‡ä»¶**: `configs/basicvsrpp/mosaic_restoration_generic_stage1.py`

